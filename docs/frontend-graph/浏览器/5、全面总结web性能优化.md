Web æ€§èƒ½ä¼˜åŒ–ä¸»è¦æ˜¯ä¸ºäº†æå‡ç”¨æˆ·ä½“éªŒï¼Œç”¨æˆ·æœ€ç›´è§‚çš„æ„Ÿå—å°±æ˜¯çœ‹é¡µé¢æ˜¯å¦å¡é¡¿ï¼Œæ˜¯å¦å¡é¡¿æ˜¯ç›´è§‚æ„Ÿå—ï¼Œæ‰€ä»¥éœ€è¦ä¸€äº› **Webæ€§èƒ½æŒ‡æ ‡** æ¥ç›‘æµ‹ï¼ŒåŒæ—¶éœ€è¦æŒæ¡æµè§ˆå™¨æ¸²æŸ“çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œæ•´ä¸ªè¿‡ç¨‹åˆ†æˆ **é¡µé¢å¯¼èˆª** å’Œ **é¡µé¢æ¸²æŸ“** ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå¯é’ˆå¯¹ä¸åŒéƒ¨åˆ†è¿›è¡Œä¼˜åŒ–ï¼Œå…·ä½“ç»†èŠ‚å‚è€ƒæ–‡ç«  [æµè§ˆå™¨çš„å·¥ä½œåŸç†](./3ã€æµè§ˆå™¨çš„å·¥ä½œåŸç†.html)ã€‚
æœ€åæ€§èƒ½ä¼˜åŒ–è¿˜åŒ…æ‹¬å¼€å‘æ—¶æ‰€ä½¿ç”¨çš„ **æ¡†æ¶ã€æ‰“åŒ…å·¥å…·ä»¥åŠä»£ç å±‚é¢çš„ä¼˜åŒ–**

æ‰€ä»¥ï¼ŒWeb æ€§èƒ½ä¼˜åŒ–å¯å¤§è‡´åˆ†æˆä¸€äº›éƒ¨åˆ†
- Web æ€§èƒ½æŒ‡æ ‡
- HTTP ç½‘ç»œå±‚é¢ä¼˜åŒ–ï¼ˆé¡µé¢å¯¼èˆªï¼‰
- DOM å±‚é¢ä¼˜åŒ–ï¼ˆé¡µé¢æ¸²æŸ“ï¼‰
- æ¡†æ¶ã€æ‰“åŒ…å·¥å…·ä»¥åŠä»£ç å±‚é¢ä¼˜åŒ– (å¼€å‘é˜¶æ®µ)

## ä¸€ã€Webæ€§èƒ½æŒ‡æ ‡

## äºŒã€HTTPç½‘ç»œå±‚é¢ä¼˜åŒ–
HTTPç½‘ç»œå±‚é¢ä¼˜åŒ–æ˜¯æŒ‡é¡µé¢å¯¼èˆªé˜¶æ®µï¼Œä¹Ÿå°±æ˜¯æµè§ˆå™¨è¾“å…¥URLåˆ°æœåŠ¡å™¨è¿”å›HTMLå­—ç¬¦ä¸²è¿™ä¸ªé˜¶æ®µï¼Œä¸»è¦åˆ†æˆä»¥ä¸‹æ­¥éª¤

> URL è§£æ -> ç¼“å­˜æ£€æŸ¥ -> DNS è§£æ -> TCP è¿æ¥ -> æ•°æ®ä¼ è¾“ -> TCPæ–­å¼€è¿æ¥

### 2.1ã€DNS è§£æ

- DNS è§£ææµç¨‹åŠåŸç†

- ä¼˜åŒ–æ–¹æ¡ˆ

`DNS Prefetch`, DNS é¢„è§£æ

æ–¹æ³•ä¸€: åœ¨ `index.html` çš„ `<head>` ä¸­æ·»åŠ ğŸ‘‡ï¼Œ(å‰ç«¯æ§åˆ¶)
```html
<link rel="dns-prefetch"  href="//d.jd.com"> //äº¬ä¸œ
```

æ–¹æ³•äºŒ: åœ¨ `index.html` çš„ `å“åº”å¤´` ä¸­æ·»åŠ ğŸ‘‡ï¼Œ(åç«¯æ§åˆ¶)
```text
Link: <https://d.jd.com>; rel=dns-prefetch
```

### 2.2ã€TCP è¿æ¥
é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½ä¼šå»ºç«‹ TCP è¿æ¥ï¼Œååˆ†æ¶ˆè€—æ€§èƒ½ï¼Œå¦‚ä½•ä¼˜åŒ–ï¼Ÿ

#### 2.2.1ã€è¿æ¥å¤ç”¨

**`http 1.0`** é˜¶æ®µï¼Œæ¯ä¸ªè¯·æ±‚éƒ½ä¼šå»ºç«‹å•ç‹¬çš„ TCP è¿æ¥
```text
è¯·æ±‚A: å¼€å¯TCP -> è¯·æ±‚ -> å“åº” -> æ–­å¼€TCP
è¯·æ±‚B: å¼€å¯TCP -> è¯·æ±‚ -> å“åº” -> æ–­å¼€TCP
```

**`http 1.1`** é˜¶æ®µï¼Œè®¾ç½®è¯·æ±‚å¤´ `Connection: keep-alive` å³å¯å¼€å¯è¿æ¥å¤ç”¨ï¼Œå¤šä¸ªè¯·æ±‚ä½¿ç”¨åŒä¸€ä¸ª TCP è¿æ¥ï¼Œä¸å•ç‹¬è¿›è¡Œåˆ›å»º

```text
å¼€å¯TCP -> Aè¯·æ±‚ -> Aå“åº” -> Bè¯·æ±‚ -> Bå“åº” -> æ–­å¼€TCP
```
å½“ä¸¤ä¸ªè¯·æ±‚çš„é—´éš”æ—¶é—´è¿‡é•¿ï¼ŒTCP è¿æ¥ä¸€ç›´å¤„äºç©ºé—²é˜¶æ®µï¼Œå¯é€šè¿‡æ·»åŠ  `Keep-Alive` æ¶ˆæ¯å¤´ï¼Œæ¥æŒ‡å®šä¸€ä¸ªç©ºé—²TCPè¿æ¥éœ€è¦ä¿æŒæ‰“å¼€çŠ¶æ€çš„æœ€å°æ—¶é•¿, ä¾‹å¦‚ğŸ‘‡

```
HTTP/1.1 200 OK
Connection: Keep-Alive
Keep-Alive: timeout=5, max=1000
```
å±æ€§å€¼åˆ†åˆ«è¡¨ç¤ºï¼š
- `timeout`: ä¸€ä¸ªç©ºé—²TCPè¿æ¥éœ€è¦ä¿æŒæ‰“å¼€çŠ¶æ€çš„æœ€å°æ—¶é•¿ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰
- `max`: åœ¨TCPè¿æ¥å…³é—­ä¹‹å‰ï¼Œåœ¨æ­¤è¿æ¥å¯ä»¥å‘é€çš„è¯·æ±‚çš„æœ€å¤§å€¼ (**HTTPç®¡é“è¿æ¥**åˆ™å¯ä»¥ç”¨å®ƒæ¥é™åˆ¶ç®¡é“çš„ä½¿ç”¨)

#### 2.2.2ã€å¹¶è¡ŒåŒ–è¿æ¥

å½“ HTML ä¸­éœ€è¦åŠ è½½ CSS,JS, é™æ€æ–‡ä»¶æ—¶ï¼Œæµè§ˆå™¨ä¼šåŒæ—¶å¹¶è¡Œå‘é€å¤šä¸ª TCP è¿æ¥ï¼Œæé«˜é¡µé¢åŠ è½½æ•ˆç‡ï¼Œä½†æµè§ˆå™¨å¯¹åŒä¸€åŸŸåä¸‹çš„ **TCPè¿æ¥æ•°** æœ‰é™åˆ¶ï¼ˆChromeé™åˆ¶æ•°å¤§æ¦‚æ˜¯ 6 ä¸ªï¼‰

æ‰€ä»¥å½“åŒä¸€åŸŸåä¸‹çš„TCPè¿æ¥æ•°è¾¾åˆ°ä¸Šé™åï¼Œåé¢çš„è¯·æ±‚å¯ä»¥å¤ç”¨å‰é¢çš„ TCPè¿æ¥

#### 2.2.3ã€ç®¡é“åŒ–

http è¯·æ±‚æ€»æ˜¯é¡ºåºå‘é€çš„ï¼Œä¸‹ä¸€ä¸ªè¯·æ±‚åªæœ‰åœ¨å½“å‰è¯·æ±‚çš„å“åº”è¢«å®Œå…¨æ¥å—çš„æ—¶å€™æ‰ä¼šè¢«å‘é€ï¼Œè€Œ HTTP/1.1 å…è®¸å¤šä¸ªhttpè¯·æ±‚é€šè¿‡ä¸€ä¸ªå¥—æ¥å­—åŒæ—¶è¢«å‘é€ï¼Œç„¶åè¯·æ±‚è€…å°±ä¼šç­‰å¾…å„è‡ªçš„å“åº”ï¼Œè¿™äº›å“åº”æ˜¯æŒ‰ç…§ä¹‹å‰è¯·æ±‚çš„é¡ºåºä¾æ¬¡åˆ°è¾¾ï¼Œè¯·æ±‚å’Œå“åº”éƒ½éœ€è¦ä¿æŒä¸€ä¸ª **`FIFOé˜Ÿåˆ—`** é¡ºåºã€‚ï¼ˆ ps: `æœåŠ¡å™¨å…ˆåæ”¶åˆ°Aï¼ŒBè¯·æ±‚ï¼Œå¤„ç†Aéœ€è¦10msï¼Œå¤„ç†Béœ€è¦1msï¼Œä½† Bä¸èƒ½ç«‹å³è¿”å›ï¼Œéœ€ç­‰å¾…Aå¤„ç†å®Œï¼ŒæŒ‰ç…§A,B é¡ºåºä¾æ¬¡è¿”å›` ï¼‰

åªæœ‰å¹‚ç­‰çš„è¯·æ±‚æ‰å¯ä»¥è¢«ç®¡é“åŒ–ï¼Œæ¯”å¦‚`GET`å’Œ`HEAD`ã€‚`POST`å’Œ`PUT`ä¸åº”è¯¥è¢«ç®¡é“åŒ–ï¼ŒHTTPç®¡é“åŒ–æœ¬èº«å¯èƒ½ä¼šå¯¼è‡´**é˜Ÿå¤´é˜»å¡**çš„é—®é¢˜ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨æ˜¯å…³é—­äº† HTTPç®¡é“åŒ–

> HTTP/æ–¹æ³•çš„å¹‚ç­‰æ€§: æ˜¯æŒ‡ä¸€æ¬¡å’Œå¤šæ¬¡è¯·æ±‚æŸä¸€ä¸ªèµ„æºåº”è¯¥å…·æœ‰åŒæ ·çš„å‰¯ä½œç”¨, å®é™…ä¸Šå°±æ˜¯å¤šæ¬¡æ“ä½œéƒ½ä¸ä¼šæ”¹å˜ç»“æœçš„è¯·æ±‚

### 2.3ã€HTTP2.0
é’ˆå¯¹ `HTTP1.1` ä¸­ç®¡é“åŒ–å¯¼è‡´çš„é˜Ÿå¤´é˜»å¡ï¼Œå¯ä½¿ç”¨ `HTTP2` æ¥è§£å†³

#### 2.3.1ã€å¤šè·¯å¤ç”¨

`HTTP2` ä¸­ä¸ä½¿ç”¨ç®¡é“åŒ–ï¼Œè€Œæ˜¯å¼•å…¥**æµ** (`Stream`)å’Œ **å¸§**ï¼ˆ`Frame`ï¼‰çš„æ¦‚å¿µ

- ä¸€ä¸ªå¸§ç”±`Length + Type + Flags + StreamID + Payload` äº”éƒ¨åˆ†ç»„æˆï¼Œå‰å››éƒ¨åˆ†æ˜¯å›ºå®šé•¿åº¦ï¼Œä¸º 9 ä¸ªå­—èŠ‚ï¼Œç¬¬äº”éƒ¨åˆ†é•¿åº¦ä¸º `2^14` è‡³ `2^24 - 1`, å³ `16Kb` åˆ° `16Mb`
- è¯·æ±‚å¤´å’Œå“åº”å¤´éƒ½ä¼šè¢«å‘é€æ–¹å‹ç¼©åï¼Œåˆ†æˆå‡ ä¸ªè¿ç»­çš„ `Frame` ä¼ è¾“ï¼Œå¤´å­—æ®µä¼šä¿å­˜åœ¨ `Payload` ä¸­ï¼Œæ¥æ”¶æ–¹æ‹¼åˆè¿™äº› `Frame` åï¼Œè§£å‹åå³å¯æ‹¿åˆ°çœŸæ­£çš„è¯·æ±‚å¤´å’Œå“åº”å¤´
- ä¸€ä¸ªæµç”±åŒå‘ä¼ è¾“çš„æœ‰åºä¸”è¿ç»­çš„ `Frame` ç»„æˆï¼Œä¸€ä¸ªTCPè¿æ¥å¯ä»¥åŒæ—¶åŒ…å«å¤šä¸ª `Stream` ï¼Œä¸€ä¸ª `Stream` åªç”¨äºä¸€æ¬¡è¯·æ±‚å’Œå“åº”ã€‚`Stream` ä¹‹é—´ä¸ä¼šç›¸äº’å½±å“

#### 2.3.2ã€æœåŠ¡å™¨æ¨é€
> æœåŠ¡å™¨æ¨é€ Server Push: æœåŠ¡å™¨å¯ä»¥æå‰ä¸»åŠ¨å°†æœªæ¥å°†è¦è¯·æ±‚çš„èµ„æºæ¨é€åˆ°å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ¥æ”¶èµ„æºåä¼šè¿›è¡Œç¼“å­˜ï¼Œåé¢ç›´æ¥è¯»å–ç¼“å­˜å³å¯

**å¦‚ä½•è®¾ç½® Server Push ï¼Ÿ**

- ä½¿ç”¨ nginx ä¸­ `http2_push` å­—æ®µè®¾ç½®æ¨é€èµ„æº
```nginx
location / {
  root /usr/share/nginx/html;
  index index.html index.htm;
  http2_push /style.css;
  http2_push /example.png;
}
```

- åœ¨ nginx ä¸­å¼€å¯ `Server Push`, åœ¨å“åº”å¤´ä¸­è®¾ç½®æ¨é€èµ„æº

å¼€å¯æ¨é€
```nginx
location / {
  ...
  http2_push_preload on;
}
```
åœ¨ `index.html` å“åº”å¤´ä¸­æ·»åŠ 
```
Link:</style.css>; rel=preload; as=style
```

**Server Push çš„ç¼ºé™·ï¼Ÿ**

- å‰ç«¯èµ„æºé€šè¿‡æ‰“åŒ…å·¥å…·æ‰“åŒ…åï¼Œæ–‡ä»¶åéƒ½æ˜¯å¸¦æœ‰ `hash` å€¼çš„ï¼Œæ¯æ¬¡æ‰“åŒ…åéƒ½æ›´æ”¹ nginx é…ç½®ï¼Œä¸åˆå®é™…

### 2.4ã€HTTP 1.1

å½“æˆ‘ä»¬çš„æœåŠ¡å› ä¸ºæŸäº›åŸå› æ— æ³•ä½¿ç”¨ HTTP2.0ï¼Œé‚£ä¹ˆåœ¨ HTTP 1.1 é˜¶æ®µæœ‰å“ªäº›ä¼˜åŒ–æ–¹æ¡ˆï¼Ÿ

#### 2.4.1 èµ„æºåˆå¹¶

CSS é›ªç¢§å›¾ -> `Icon Font` -> `SVG Symbols`

#### 2.4.2 èµ„æºå†…è”

```
å°å›¾ç‰‡ -> data URL
å° CSS æ–‡ä»¶ -> `<style>...</style>`
å° JS æ–‡ä»¶ -> `<script>...</script>`
```

ä»¥ä¸Šéƒ½å¯é€šè¿‡ webpack æ’ä»¶æ¥å®ç°

#### 2.4.3 èµ„æºå‹ç¼©

ç›®å‰æœ€å¸¸ç”¨çš„å‹ç¼©ç®—æ³•æ˜¯ gzip, å…·ä½“å®ç°å¦‚ä¸‹

**`nginx`**

```
server {
  gzip on;
  gzip_types      text/plain application/xml;
  gzip_proxied    no-cache no-store private expired auth;
  gzip_min_length 1000;
  ...
}
```
nginx å®é™…æä¾›ä¿©ç§ gzip æ¨¡å¼: `gzip on` å’Œ `gzip_static on`, åŒºåˆ«å¦‚ä¸‹ï¼š

  - `gzip on` ä¼šåœ¨æ¯æ¬¡è¯·æ±‚æ—¶å®æ—¶å‹ç¼©æ–‡ä»¶ï¼Œè€—è´¹æ€§èƒ½
  - `gzip_static on` ä¼˜å…ˆçº§æ›´é«˜ï¼Œåœ¨é‡åˆ° `path/to/file` çš„è¯·æ±‚æ—¶ï¼Œä¼šä¼˜å…ˆæŸ¥çœ‹ `path/to/file.gz` ä½œä¸ºå‹ç¼©ç‰ˆæœ¬ï¼Œæ‰¾ä¸åˆ°å°±ç›´æ¥è¿”å›æœªå‹ç¼©ç‰ˆæœ¬ã€‚è¯¥åŠŸèƒ½éœ€è¦åœ¨ç¼–è¯‘ nginx æ—¶æ·»åŠ æ‰©å±•é€‰é¡¹
  - å¯é€šè¿‡ webpack æ’ä»¶ `compression-webpack-plugin` ç”Ÿæˆ `.gz` åç¼€æ–‡ä»¶ï¼ŒåŒæ—¶é»˜è®¤ä¿ç•™æºæ–‡ä»¶


**`Apache`**

å‚è€ƒæ–‡æ¡£ [How To Enable GZIP Compression in Apache](https://ubiq.co/tech-blog/enable-gzip-compression-apache/)

**`Node.js`**

å‚è€ƒæ–‡æ¡£ [Node Zlib](https://nodejs.org/api/zlib.html#zlib_compressing_http_requests_and_responses)

-  æ ¸å¿ƒä»£ç 
```js
let acceptEncoding = request.headers['accept-encoding'];
if (!acceptEncoding) {
  acceptEncoding = '';
}

// Note: This is not a conformant accept-encoding parser.
// See https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.3
if (/\bdeflate\b/.test(acceptEncoding)) {
  response.writeHead(200, { 'Content-Encoding': 'deflate' });
  pipeline(raw, zlib.createDeflate(), response, onError);
} else if (/\bgzip\b/.test(acceptEncoding)) {
  response.writeHead(200, { 'Content-Encoding': 'gzip' });
  pipeline(raw, zlib.createGzip(), response, onError);
} else if (/\bbr\b/.test(acceptEncoding)) {
  response.writeHead(200, { 'Content-Encoding': 'br' });
  pipeline(raw, zlib.createBrotliCompress(), response, onError);
} else {
  response.writeHead(200, {});
  pipeline(raw, response, onError);
}
```

ç¼ºé™·ï¼šå¯¹å‹ç¼©çš„ç»“æœæ²¡æœ‰åšç¼“å­˜ 

#### 2.4.4ã€èµ„æºç²¾ç®€

```
HTML: åˆ ç©ºæ ¼ï¼Œåˆ é—­åˆ
CSS: åˆ æœªç”¨ class (ä¸æ¨èï¼Œå¯èƒ½å­˜åœ¨åŠ¨æ€ class )
JS:  ä»£ç å‹ç¼©(æ”¹å)ã€tree shaking (é€šè¿‡åˆ†æ import)
SVG: åˆ é™¤æ— ç”¨æ ‡ç­¾ï¼Œå±æ€§
å›¾ç‰‡ï¼š å‡å°‘ä½“ç§¯ï¼ˆæ— æŸå’Œæœ‰æŸï¼‰
```
ä»¥ä¸Šæ“ä½œéƒ½å¯é€šè¿‡ webpack æ’ä»¶å®ç°

#### 2.4.5ã€Cookie ä¼˜åŒ–

 è®¾è®¡ Cookie æ˜¯ä¸ºäº†æ ¡éªŒç”¨æˆ·çš„ï¼Œä½†åœ¨æœ€å¼€å§‹è¢«æ»¥ç”¨ï¼Œç”¨æ¥å­˜å‚¨æ•°æ®ï¼ˆ4KBçš„å¤§å°ï¼‰ï¼Œç”±äºåŒä¸€åŸŸåä¸‹çš„æ¯ä¸ªè¯·æ±‚éƒ½ä¼šå¸¦ä¸Š Cookie, å¯¼è‡´æœåŠ¡ç«¯å‹åŠ›å¤§ï¼ŒåŒæ—¶å½±å“å¸¦å®½æ€§èƒ½ï¼Œæ‰€ä»¥ Cookie éœ€è¦è¿›è¡Œä¼˜åŒ–

 - å‡å°‘å¯¹ `Cookie` çš„ä½¿ç”¨, å­˜å‚¨æ”¾åˆ° `Storage` ä¸­
 - å¯ç”¨æ–°åŸŸåï¼Œæ–°åŸŸåçš„å¥½å¤„åœ¨äº `Cookie-Free`


## ä¸‰ã€DOMå±‚é¢ä¼˜åŒ–

## å››ã€æ¡†æ¶ã€æ‰“åŒ…å·¥å…·ä»¥åŠä»£ç å±‚é¢ä¼˜åŒ–

### 4.1 æ¡†æ¶

### 4.2 æ‰“åŒ…å·¥å…·