import{o as n,c as s,a as l,b as a}from"./app.a1522aa7.js";const t='{"title":"ä¸€ã€åˆè¯† nginx","description":"","frontmatter":{},"headers":[{"level":2,"title":"ä¸€ã€åˆè¯† nginx","slug":"ä¸€ã€åˆè¯†-nginx"},{"level":3,"title":"1.1ã€å®‰è£…","slug":"_1-1ã€å®‰è£…"},{"level":3,"title":"1.2ã€æ“ä½œ","slug":"_1-2ã€æ“ä½œ"},{"level":3,"title":"1.3ã€é…ç½®æ–‡ä»¶","slug":"_1-3ã€é…ç½®æ–‡ä»¶"},{"level":2,"title":"äºŒã€nginx å·¥ä½œæµ","slug":"äºŒã€nginx-å·¥ä½œæµ"},{"level":2,"title":"ä¸‰ã€nginx å®æˆ˜","slug":"ä¸‰ã€nginx-å®æˆ˜"},{"level":3,"title":"3.1ã€é™æ€èµ„æº web æœåŠ¡","slug":"_3-1ã€é™æ€èµ„æº-web-æœåŠ¡"},{"level":3,"title":"3.2ã€æµè§ˆå™¨ç¼“å­˜","slug":"_3-2ã€æµè§ˆå™¨ç¼“å­˜"},{"level":3,"title":"3.3ã€è·¨åŸŸ","slug":"_3-3ã€è·¨åŸŸ"},{"level":3,"title":"3.4ã€ä»£ç†","slug":"_3-4ã€ä»£ç†"},{"level":3,"title":"3.5ã€è´Ÿè½½å‡è¡¡","slug":"_3-5ã€è´Ÿè½½å‡è¡¡"},{"level":2,"title":"4ã€location","slug":"_4ã€location"},{"level":3,"title":"4.1ã€æ­£åˆ™è¡¨è¾¾å¼","slug":"_4-1ã€æ­£åˆ™è¡¨è¾¾å¼"},{"level":3,"title":"4.2ã€è¯­æ³•è§„åˆ™","slug":"_4-2ã€è¯­æ³•è§„åˆ™"},{"level":3,"title":"4.3ã€åŒ¹é…è§„åˆ™","slug":"_4-3ã€åŒ¹é…è§„åˆ™"},{"level":2,"title":"5ã€rewrite","slug":"_5ã€rewrite"}],"relativePath":"source-analysis/å‰ç«¯è¿ç»´/4ã€nginxå­¦ä¹ .md","lastUpdated":1630371177555}',e={},o=[l("p",null,[a("å­¦ä¹ æŒæ¡å¥½ "),l("code",null,"nginx"),a(",")],-1),l("h2",{id:"ä¸€ã€åˆè¯†-nginx"},[l("a",{class:"header-anchor",href:"#ä¸€ã€åˆè¯†-nginx","aria-hidden":"true"},"#"),a(" ä¸€ã€åˆè¯† nginx")],-1),l("h3",{id:"_1-1ã€å®‰è£…"},[l("a",{class:"header-anchor",href:"#_1-1ã€å®‰è£…","aria-hidden":"true"},"#"),a(" 1.1ã€å®‰è£…")],-1),l("p",null,"ä»¥ centos ä¸ºä¾‹ï¼Œé€šè¿‡ yum è¿›è¡Œå®‰è£…",-1),l("div",{class:"language-shell"},[l("pre",null,[l("code",null,[l("span",{class:"token comment"},"# å®‰è£…nginx"),a("\nyum "),l("span",{class:"token function"},"install"),a(" nginx -y\n"),l("span",{class:"token comment"},"# æŸ¥çœ‹å®‰è£…çš„ç‰ˆæœ¬"),a("\nnginx -v\n"),l("span",{class:"token comment"},"# æŸ¥çœ‹ç¼–è¯‘æ—¶çš„å‚æ•°"),a("\nnginx -V \n")])])],-1),l("h3",{id:"_1-2ã€æ“ä½œ"},[l("a",{class:"header-anchor",href:"#_1-2ã€æ“ä½œ","aria-hidden":"true"},"#"),a(" 1.2ã€æ“ä½œ")],-1),l("p",null,[l("strong",null,"å‘½ä»¤")],-1),l("div",{class:"language-shell"},[l("pre",null,[l("code",null,[a("systemctl "),l("span",{class:"token punctuation"},"["),a("option"),l("span",{class:"token punctuation"},"]"),a(" nginx.server\n")])])],-1),l("p",null,[l("strong",null,"option")],-1),l("ul",null,[l("li",null,[l("code",null,"start"),a(": å¯åŠ¨")]),l("li",null,[l("code",null,"stop"),a(": åœæ­¢")]),l("li",null,[l("code",null,"status"),a(": çŠ¶æ€")]),l("li",null,[l("code",null,"restart"),a(": é‡å¯")]),l("li",null,[l("code",null,"reload"),a(": é‡æ–°è¯»å–é…ç½®")])],-1),l("h3",{id:"_1-3ã€é…ç½®æ–‡ä»¶"},[l("a",{class:"header-anchor",href:"#_1-3ã€é…ç½®æ–‡ä»¶","aria-hidden":"true"},"#"),a(" 1.3ã€é…ç½®æ–‡ä»¶")],-1),l("p",null,[a("ä¸Šé¢å®‰è£…çš„ nginx ç‰ˆæœ¬ä¸º "),l("code",null,"nginx/1.20.1"),a("ï¼Œä»¥æ­¤ä¸ºä¾‹ï¼Œnginx é…ç½®æ–‡ä»¶å¦‚ä¸‹")],-1),l("ul",null,[l("li",null,[l("p",null,[l("code",null,"/etc/nginx/nginx.conf"),a(": ä¸»é…ç½®æ–‡ä»¶")])]),l("li",null,[l("p",null,[l("code",null,"/etc/nginx/conf.d/*.conf"),a(": åŒ…å«"),l("code",null,"conf.d"),a("ç›®å½•ä¸‹é¢çš„æ‰€æœ‰é…ç½®æ–‡ä»¶")])]),l("li",null,[l("p",null,[l("code",null,"/etc/nginx/default.d/*.conf"),a(": åŒ…å«"),l("code",null,"default.d"),a("ç›®å½•ä¸‹é¢çš„æ‰€æœ‰é…ç½®æ–‡ä»¶")])])],-1),l("h4",{id:"_1-3-1ã€nginxé…ç½®è¯­æ³•"},[l("a",{class:"header-anchor",href:"#_1-3-1ã€nginxé…ç½®è¯­æ³•","aria-hidden":"true"},"#"),a(" 1.3.1ã€nginxé…ç½®è¯­æ³•")],-1),l("p",null,[a("ä¸»é…ç½®æ–‡ä»¶ "),l("code",null,"/etc/nginx/nginx.conf"),a(" é…ç½®å¦‚ä¸‹")],-1),l("div",{class:"language-nginx"},[l("pre",null,[l("code",null,[l("span",{class:"token comment"},"# å…¨å±€é…ç½® "),a("\n"),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"user"),a(" nginx")]),l("span",{class:"token punctuation"},";"),a(),l("span",{class:"token comment"},"# user: è®¾ç½®nginxæœåŠ¡çš„ç³»ç»Ÿä½¿ç”¨ç”¨æˆ·"),a("\n"),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"worker_processes"),a(" auto")]),l("span",{class:"token punctuation"},";"),a(),l("span",{class:"token comment"},"# å·¥ä½œè¿›ç¨‹æ•°,ä¸€èˆ¬å’ŒCPUæ•°é‡ç›¸åŒ"),a("\n"),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"error_log"),a(" /var/log/nginx/error.log")]),l("span",{class:"token punctuation"},";"),a(),l("span",{class:"token comment"},"# nginxçš„é”™è¯¯æ—¥å¿—"),a("\n"),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"pid"),a(" /run/nginx.pid")]),l("span",{class:"token punctuation"},";"),a(),l("span",{class:"token comment"},"# nginxæœåŠ¡å¯åŠ¨æ—¶çš„pid"),a("\n\n"),l("span",{class:"token comment"},"# Load dynamic modules. See /usr/share/doc/nginx/README.dynamic."),a("\n"),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"include"),a(" /usr/share/nginx/modules/*.conf")]),l("span",{class:"token punctuation"},";"),a("\n\n"),l("span",{class:"token comment"},"# äº‹ä»¶é…ç½® "),a("\n"),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"events")]),a(),l("span",{class:"token punctuation"},"{"),a("\n    "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"worker_connections"),a(),l("span",{class:"token number"},"1024")]),l("span",{class:"token punctuation"},";"),a(),l("span",{class:"token comment"},"# æ¯ä¸ªè¿›ç¨‹å…è®¸çš„æœ€å¤§è¿æ¥æ•° "),a("\n"),l("span",{class:"token punctuation"},"}"),a("\n\n"),l("span",{class:"token comment"},"# http é…ç½®"),a("\n"),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"http")]),a(),l("span",{class:"token punctuation"},"{"),a("\n\n    "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"log_format"),a("  main  "),l("span",{class:"token string"},[a("'"),l("span",{class:"token variable"},"$remote_addr"),a(" - "),l("span",{class:"token variable"},"$remote_user"),a(" ["),l("span",{class:"token variable"},"$time_local]"),a(' "'),l("span",{class:"token variable"},"$request"),a("\" '")]),a("\n                      "),l("span",{class:"token string"},[a("'"),l("span",{class:"token variable"},"$status"),a(),l("span",{class:"token variable"},"$body_bytes_sent"),a(' "'),l("span",{class:"token variable"},"$http_referer"),a("\" '")]),a("\n                      "),l("span",{class:"token string"},[a("'\""),l("span",{class:"token variable"},"$http_user_agent"),a('" "'),l("span",{class:"token variable"},"$http_x_forwarded_for"),a("\"'")])]),l("span",{class:"token punctuation"},";"),a(),l("span",{class:"token comment"},"# æ—¥å¿—è®°å½•æ ¼å¼"),a("\n\n    "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"access_log"),a("  /var/log/nginx/access.log  main")]),l("span",{class:"token punctuation"},";"),a(),l("span",{class:"token comment"},"# é»˜è®¤è®¿é—®æ—¥å¿—"),a("\n\n    "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"sendfile"),a("            "),l("span",{class:"token boolean"},"on")]),l("span",{class:"token punctuation"},";"),a("  "),l("span",{class:"token comment"},"# å¯åŠ¨ sendfile"),a("\n    "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"tcp_nopush"),a("          "),l("span",{class:"token boolean"},"on")]),l("span",{class:"token punctuation"},";"),a("  "),l("span",{class:"token comment"},"# tcp_nopush: æ‡’å‘é€"),a("\n    "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"tcp_nodelay"),a("         "),l("span",{class:"token boolean"},"on")]),l("span",{class:"token punctuation"},";"),a("  \n    "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"keepalive_timeout"),a("   "),l("span",{class:"token number"},"65")]),l("span",{class:"token punctuation"},";"),a("  "),l("span",{class:"token comment"},"# è¶…æ—¶æ—¶é—´"),a("\n    "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"types_hash_max_size"),a(),l("span",{class:"token number"},"4096")]),l("span",{class:"token punctuation"},";"),a(" \n\n    "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"include"),a("             /etc/nginx/mime.types")]),l("span",{class:"token punctuation"},";"),a(),l("span",{class:"token comment"},"# æ–‡ä»¶åç¼€å’Œç±»å‹ç±»å‹çš„å¯¹åº”å…³ç³»"),a("\n    "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"default_type"),a("        application/octet-stream")]),l("span",{class:"token punctuation"},";"),a(),l("span",{class:"token comment"},"# é»˜è®¤content-type"),a("\n\n    "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"include"),a(" /etc/nginx/conf.d/*.conf")]),l("span",{class:"token punctuation"},";"),a(),l("span",{class:"token comment"},"# åŒ…å«çš„å­é…ç½®æ–‡ä»¶"),a("\n\n    "),l("span",{class:"token comment"},"# server é…ç½®"),a("\n    "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"server")]),a(),l("span",{class:"token punctuation"},"{"),a("\n        "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"listen"),a("       "),l("span",{class:"token number"},"80")]),l("span",{class:"token punctuation"},";"),a(),l("span",{class:"token comment"},"# ç›‘å¬ç«¯å£"),a("\n        "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"listen"),a("       [::]:80")]),l("span",{class:"token punctuation"},";"),a(" \n        "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"server_name"),a("  _")]),l("span",{class:"token punctuation"},";"),a(),l("span",{class:"token comment"},"# ç”¨åŸŸåæ–¹å¼è®¿é—®çš„åœ°å€"),a("\n        "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"root"),a("         /usr/share/nginx/html")]),l("span",{class:"token punctuation"},";"),a(),l("span",{class:"token comment"},"# é™æ€æ–‡ä»¶æ ¹ç›®å½•"),a("\n\n        "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"location"),a(" /")]),a(),l("span",{class:"token punctuation"},"{"),a("\n          "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"root"),a(" /usr/share/nginx/html")]),l("span",{class:"token punctuation"},";"),a("\n          "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"index"),a(" index.html index.htm")]),l("span",{class:"token punctuation"},";"),a(),l("span",{class:"token comment"},"# é¦–é¡µçš„ç´¢å¼•æ–‡ä»¶"),a("\n        "),l("span",{class:"token punctuation"},"}"),a("\n\n        "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"error_page"),a(),l("span",{class:"token number"},"404"),a(" /404.html")]),l("span",{class:"token punctuation"},";"),a(),l("span",{class:"token comment"},"# æŒ‡å®šé”™è¯¯é¡µé¢ ğŸ™…â€â™‚ï¸"),a("\n        "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"location"),a(" = /404.html")]),a(),l("span",{class:"token punctuation"},"{"),a("\n        "),l("span",{class:"token punctuation"},"}"),a("\n\n        "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"error_page"),a(),l("span",{class:"token number"},"500"),a(),l("span",{class:"token number"},"502"),a(),l("span",{class:"token number"},"503"),a(),l("span",{class:"token number"},"504"),a(" /50x.html")]),l("span",{class:"token punctuation"},";"),a(),l("span",{class:"token comment"},"# æŠŠåå°é”™è¯¯é‡å®šå‘åˆ°é™æ€çš„50x.htmlé¡µé¢"),a("\n        "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"location"),a(" = /50x.html")]),a(),l("span",{class:"token punctuation"},"{"),a("\n        "),l("span",{class:"token punctuation"},"}"),a("\n    "),l("span",{class:"token punctuation"},"}"),a("\n"),l("span",{class:"token punctuation"},"}"),a("\n")])])],-1),l("ul",null,[l("li",null,[a("é…ç½®æ–‡ä»¶ç”± "),l("strong",null,"æŒ‡ä»¤"),a(" ä¸ "),l("strong",null,"æŒ‡ä»¤å—"),a(" ç»„æˆ,æŒ‡ä»¤å—ä»¥"),l("code",null,"{}"),a("å°†å¤šæ¡æŒ‡ä»¤ç»„ç»‡åœ¨ä¸€èµ·")]),l("li",null,[a("æ¯æ¡æŒ‡ä»¤ä»¥ "),l("strong",null,[l("code",null,";"),a("(åˆ†å·)")]),a(" ç»“å°¾ï¼ŒæŒ‡ä»¤ä¸å‚æ•°ä¹‹é—´ä»¥ç©ºæ ¼åˆ†éš”")]),l("li",null,[l("code",null,"include"),a(" è¯­å¥å…è®¸æŠŠå¤šä¸ªé…ç½®æ–‡ä»¶ç»„åˆèµ·æ¥ä»¥æå‡å¯ç»´æŠ¤æ€§")]),l("li",null,[a("ä¸€ä¸ª"),l("code",null,"http"),a("ä¸‹é¢å¯ä»¥é…ç½®å¤šä¸ª "),l("code",null,"server"),a(", ä¸€ä¸ª "),l("code",null,"server"),a(" ä¸‹é¢å¯ä»¥é…ç½®å¤šä¸ª "),l("code",null,"location")])],-1),l("h2",{id:"äºŒã€nginx-å·¥ä½œæµ"},[l("a",{class:"header-anchor",href:"#äºŒã€nginx-å·¥ä½œæµ","aria-hidden":"true"},"#"),a(" äºŒã€nginx å·¥ä½œæµ")],-1),l("h2",{id:"ä¸‰ã€nginx-å®æˆ˜"},[l("a",{class:"header-anchor",href:"#ä¸‰ã€nginx-å®æˆ˜","aria-hidden":"true"},"#"),a(" ä¸‰ã€nginx å®æˆ˜")],-1),l("h3",{id:"_3-1ã€é™æ€èµ„æº-web-æœåŠ¡"},[l("a",{class:"header-anchor",href:"#_3-1ã€é™æ€èµ„æº-web-æœåŠ¡","aria-hidden":"true"},"#"),a(" 3.1ã€é™æ€èµ„æº web æœåŠ¡")],-1),l("p",null,[l("strong",null,"é™æ€èµ„æº"),a(": ä¸€èˆ¬å®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°webæœåŠ¡å™¨ï¼ŒwebæœåŠ¡å™¨ä»"),l("strong",null,"å†…å­˜"),a("ä¸­å–åˆ°ç›¸åº”çš„æ–‡ä»¶ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è§£æå¹¶æ¸²æŸ“æ˜¾ç¤ºå‡ºæ¥")],-1),l("p",null,[l("strong",null,"CDN"),a(": å®æ—¶åœ°æ ¹æ®ç½‘ç»œæµé‡å’Œå„èŠ‚ç‚¹çš„è¿æ¥ã€è´Ÿè½½çŠ¶å†µä»¥åŠåˆ°ç”¨æˆ·çš„è·ç¦»å’Œå“åº”æ—¶é—´ç­‰ç»¼åˆä¿¡æ¯å°†ç”¨æˆ·çš„è¯·æ±‚é‡æ–°å¯¼å‘ç¦»ç”¨æˆ·æœ€è¿‘çš„æœåŠ¡èŠ‚ç‚¹ä¸Š")],-1),l("p",null,[l("strong",null,"é…ç½®é€‰é¡¹")],-1),l("table",null,[l("thead",null,[l("tr",null,[l("th",null,"é…ç½®é¡¹"),l("th",null,"å«ä¹‰"),l("th",null,"å¯é€‰å€¼"),l("th",null,"é»˜è®¤å€¼"),l("th",null,"ä¸Šä¸‹æ–‡")])]),l("tbody",null,[l("tr",null,[l("td",null,[l("strong",null,[l("code",null,"sendfile")])]),l("td",null,"ä¸ç»è¿‡ç”¨æˆ·å†…æ ¸å‘é€æ–‡ä»¶"),l("td",null,"on/off"),l("td",null,"off"),l("td",null,[l("code",null,"http, server, location, ")])]),l("tr",null,[l("td",null,[l("strong",null,[l("code",null,"tcp_nopush")])]),l("td",null,[a("åœ¨"),l("code",null,"sendfile"),a("å¼€å¯çš„æƒ…å†µä¸‹ï¼Œåˆå¹¶å¤šä¸ªæ•°æ®åŒ…ï¼Œæé«˜ç½‘ç»œåŒ…çš„ä¼ è¾“æ•ˆç‡")]),l("td",null,"on/off"),l("td",null,"off"),l("td",null,[l("code",null,"http, server, location, ")])]),l("tr",null,[l("td",null,[l("strong",null,[l("code",null,"tcp_nodelay")])]),l("td",null,[a("åœ¨"),l("code",null,"keepalive"),a("è¿æ¥ä¸‹ï¼Œæé«˜ç½‘ç»œåŒ…çš„ä¼ è¾“å®æ—¶æ€§")]),l("td",null,"on/off"),l("td",null,"off"),l("td",null,[l("code",null,"http, server, location, ")])]),l("tr",null,[l("td",null,[l("strong",null,[l("code",null,"gzip")])]),l("td",null,"å‹ç¼©æ–‡ä»¶å¯ä»¥èŠ‚çº¦å¸¦å®½å’Œæé«˜ç½‘ç»œä¼ è¾“æ•ˆç‡ç±»å‹"),l("td",null,"on/off"),l("td",null,"off"),l("td",null,[l("code",null,"http, server, location, ")])]),l("tr",null,[l("td",null,[l("strong",null,[l("code",null,"gzip_min_length")])]),l("td",null,"æœ€å°å‹ç¼©æ–‡ä»¶çš„å¤§å°"),l("td",null,"size"),l("td"),l("td",null,[l("code",null,"http, server, location, ")])]),l("tr",null,[l("td",null,[l("strong",null,[l("code",null,"gzip_comp_level")])]),l("td",null,"å‹ç¼©çº§åˆ«, å€¼è¶Šé«˜ï¼Œå‹ç¼©çš„ä½“ç§¯è¶Šå°"),l("td",null,"level"),l("td",null,"1"),l("td",null,[l("code",null,"http, server, location, ")])]),l("tr",null,[l("td",null,[l("strong",null,[l("code",null,"gzip_http_version")])]),l("td",null,"å‹ç¼©ç‰ˆæœ¬"),l("td",null,"1.0/1.1"),l("td",null,"1.1"),l("td",null,[l("code",null,"http, server, location, ")])]),l("tr",null,[l("td",null,[l("strong",null,[l("code",null,"http_gzip-static_module")])]),l("td",null,[a("å…ˆæ‰¾ç£ç›˜ä¸Šæ‰¾åŒåçš„"),l("code",null,".gz"),a("è¿™ä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨,èŠ‚çº¦CPUçš„å‹ç¼©æ—¶é—´å’Œæ€§èƒ½æŸè€—")]),l("td",null,"on/off"),l("td",null,"off"),l("td",null,[l("code",null,"http, server, location, ")])])])],-1),l("p",null,[l("strong",null,"å®æˆ˜")],-1),l("ul",null,[l("li",null,"èµ„æº")],-1),l("div",{class:"language-shell"},[l("pre",null,[l("code",null,[l("span",{class:"token function"},"mkdir"),a(" -p /data/www/images\n"),l("span",{class:"token function"},"mkdir"),a(" -p /data/www/html\n"),l("span",{class:"token builtin class-name"},"echo"),a(" color "),l("span",{class:"token operator"},">"),a(" /data/www/html/color.html\n"),l("span",{class:"token function"},"gzip"),a(" /data/www/html/color.html\n"),l("span",{class:"token function"},"mkdir"),a(" -p /data/www/download\n")])])],-1),l("ul",null,[l("li",null,"é…ç½®")],-1),l("div",{class:"language-nginx"},[l("pre",null,[l("code",null,[l("span",{class:"token directive"},[l("span",{class:"token keyword"},"location"),a(" ~ .*\\.(jpg|png|gif)$")]),a(),l("span",{class:"token punctuation"},"{"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"gzip"),a(),l("span",{class:"token boolean"},"off")]),l("span",{class:"token punctuation"},";"),l("span",{class:"token comment"},"#å…³é—­å‹ç¼©"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"root"),a(" /data/www/images")]),l("span",{class:"token punctuation"},";"),a("\n"),l("span",{class:"token punctuation"},"}"),a("\n\n"),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"location"),a(" ~ .*\\.(html|js|css)$")]),a(),l("span",{class:"token punctuation"},"{"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"gzip_static"),a(),l("span",{class:"token boolean"},"on")]),l("span",{class:"token punctuation"},";"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"gzip"),a(),l("span",{class:"token boolean"},"on")]),l("span",{class:"token punctuation"},";"),a(),l("span",{class:"token comment"},"#å¯ç”¨å‹ç¼©"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"gzip_min_length"),a(),l("span",{class:"token number"},"1k")]),l("span",{class:"token punctuation"},";"),a("    "),l("span",{class:"token comment"},"#åªå‹ç¼©è¶…è¿‡1Kçš„æ–‡ä»¶"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"gzip_http_version"),a(" 1.1")]),l("span",{class:"token punctuation"},";"),a(),l("span",{class:"token comment"},"#å¯ç”¨gzipå‹ç¼©æ‰€éœ€çš„HTTPæœ€ä½ç‰ˆæœ¬"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"gzip_comp_level"),a(),l("span",{class:"token number"},"9")]),l("span",{class:"token punctuation"},";"),a("     "),l("span",{class:"token comment"},"#å‹ç¼©çº§åˆ«ï¼Œå‹ç¼©æ¯”ç‡è¶Šé«˜æ–‡ä»¶è¢«å‹ç¼©çš„ä½“ç§¯è¶Šå°"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"gzip_types"),a("  text/css application/javascript")]),l("span",{class:"token punctuation"},";"),l("span",{class:"token comment"},"#è¿›è¡Œå‹ç¼©çš„æ–‡ä»¶ç±»å‹"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"root"),a(" /data/www/html")]),l("span",{class:"token punctuation"},";"),a("\n"),l("span",{class:"token punctuation"},"}"),a("\n\n"),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"location"),a(" ~ ^/download")]),a(),l("span",{class:"token punctuation"},"{"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"gzip_static"),a(),l("span",{class:"token boolean"},"on")]),l("span",{class:"token punctuation"},";"),a(),l("span",{class:"token comment"},"#å¯ç”¨å‹ç¼©"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"tcp_nopush"),a(),l("span",{class:"token boolean"},"on")]),l("span",{class:"token punctuation"},";"),a("  "),l("span",{class:"token comment"},"# ä¸è¦ç€æ€¥å‘ï¼Œæ”’ä¸€æ³¢å†å‘"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"root"),a(" /data/www")]),l("span",{class:"token punctuation"},";"),a(),l("span",{class:"token comment"},"# æ³¨æ„æ­¤å¤„ç›®å½•æ˜¯`/data/www`è€Œä¸æ˜¯`/data/www/download`"),a("\n"),l("span",{class:"token punctuation"},"}"),a(" \n")])])],-1),l("h3",{id:"_3-2ã€æµè§ˆå™¨ç¼“å­˜"},[l("a",{class:"header-anchor",href:"#_3-2ã€æµè§ˆå™¨ç¼“å­˜","aria-hidden":"true"},"#"),a(" 3.2ã€æµè§ˆå™¨ç¼“å­˜")],-1),l("p",null,[l("strong",null,"æµè§ˆå™¨æ ¡éªŒæœ¬åœ°ç¼“å­˜æµç¨‹")],-1),l("p",null,[l("img",{src:"/portal-blog/images/linux/cachecontrol.png",alt:""})],-1),l("p",null,"å¯è®¾ç½®çš„å“åº”å¤´",-1),l("ul",null,[l("li",null,"Expires"),l("li",null,"Cache-Control"),l("li",null,"Etag"),l("li",null,"Last-Modified")],-1),l("p",null,[l("strong",null,"è®¾ç½® Expires")],-1),l("div",{class:"language-nginx"},[l("pre",null,[l("code",null,[l("span",{class:"token directive"},[l("span",{class:"token keyword"},"location"),a(" ~ .*\\.(jpg|png|gif)$")]),a(),l("span",{class:"token punctuation"},"{"),a("\n    "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"expires"),a(),l("span",{class:"token number"},"24h")]),l("span",{class:"token punctuation"},";"),a("\n"),l("span",{class:"token punctuation"},"}"),a("\n")])])],-1),l("h3",{id:"_3-3ã€è·¨åŸŸ"},[l("a",{class:"header-anchor",href:"#_3-3ã€è·¨åŸŸ","aria-hidden":"true"},"#"),a(" 3.3ã€è·¨åŸŸ")],-1),l("p",null,[a("å…³äºä»€ä¹ˆæ˜¯è·¨åŸŸï¼Œä»¥åŠæ±‡æ€»çš„è§£å†³åŠæ³•ï¼Œè¯·å‚è€ƒ "),l("a",{href:"https://yangjia23.github.io/portal-blog/frontend-graph/%E6%B5%8F%E8%A7%88%E5%99%A8/4%E3%80%81%E4%B8%80%E6%96%87%E6%B1%87%E6%80%BB9%E7%A7%8D%E8%B7%A8%E5%9F%9F%E6%96%B9%E6%B3%95.html",target:"_blank",rel:"noopener noreferrer"},"ä¸€æ–‡æ±‡æ€»9ç§è·¨åŸŸæ–¹æ³•"),a("ï¼Œåœ¨ nginx ä¸­è§£å†³è·¨åŸŸï¼Œéœ€è¦è®¾ç½®ä¸åŒçš„å“åº”å¤´")],-1),l("p",null,[l("strong",null,"è¯­æ³•")],-1),l("div",{class:"language-shell"},[l("pre",null,[l("code",null,"add_header name value\n")])],-1),l("p",null,[l("strong",null,"å®¢æˆ·ç«¯")],-1),l("p",null,"åœ¨å®¢æˆ·ç«¯é€šè¿‡ live-server å¼€å¯æœ¬åœ°æœåŠ¡ï¼Œå‘æœåŠ¡ç«¯å‘é€è¯·æ±‚",-1),l("div",{class:"language-html"},[l("pre",null,[l("code",null,[l("span",{class:"token doctype"},[l("span",{class:"token punctuation"},"<!"),l("span",{class:"token doctype-tag"},"DOCTYPE"),a(),l("span",{class:"token name"},"HTML"),a(),l("span",{class:"token name"},"PUBLIC"),a(),l("span",{class:"token string"},'"-//W3C//DTD HTML 4.0 Transitional//EN"'),l("span",{class:"token punctuation"},">")]),a("\n"),l("span",{class:"token tag"},[l("span",{class:"token tag"},[l("span",{class:"token punctuation"},"<"),a("html")]),l("span",{class:"token punctuation"},">")]),a("\n  "),l("span",{class:"token tag"},[l("span",{class:"token tag"},[l("span",{class:"token punctuation"},"<"),a("head")]),l("span",{class:"token punctuation"},">")]),a("\n  "),l("span",{class:"token tag"},[l("span",{class:"token tag"},[l("span",{class:"token punctuation"},"</"),a("head")]),l("span",{class:"token punctuation"},">")]),a("\n  "),l("span",{class:"token tag"},[l("span",{class:"token tag"},[l("span",{class:"token punctuation"},"<"),a("body")]),l("span",{class:"token punctuation"},">")]),a("\n    "),l("span",{class:"token tag"},[l("span",{class:"token tag"},[l("span",{class:"token punctuation"},"<"),a("script")]),l("span",{class:"token punctuation"},">")]),l("span",{class:"token script"},[l("span",{class:"token language-javascript"},[a("\n      "),l("span",{class:"token keyword"},"let"),a(" xhr "),l("span",{class:"token operator"},"="),a(),l("span",{class:"token keyword"},"new"),a(),l("span",{class:"token class-name"},"XMLHttpRequest"),l("span",{class:"token punctuation"},"("),l("span",{class:"token punctuation"},")"),l("span",{class:"token punctuation"},";"),a("\n        xhr"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function"},"open"),l("span",{class:"token punctuation"},"("),l("span",{class:"token string"},"'GET'"),l("span",{class:"token punctuation"},","),a(),l("span",{class:"token string"},"'http://{ip}/user.json'"),l("span",{class:"token punctuation"},","),a(),l("span",{class:"token boolean"},"true"),l("span",{class:"token punctuation"},")"),l("span",{class:"token punctuation"},";"),a("\n        xhr"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function-variable function"},"onreadystatechange"),a(),l("span",{class:"token operator"},"="),a(),l("span",{class:"token keyword"},"function"),a(),l("span",{class:"token punctuation"},"("),l("span",{class:"token punctuation"},")"),a(),l("span",{class:"token punctuation"},"{"),a("\n            "),l("span",{class:"token keyword"},"if"),a(),l("span",{class:"token punctuation"},"("),a("xhr"),l("span",{class:"token punctuation"},"."),a("readyState "),l("span",{class:"token operator"},"=="),a(),l("span",{class:"token number"},"4"),a(),l("span",{class:"token operator"},"&&"),a(" xhr"),l("span",{class:"token punctuation"},"."),a("status "),l("span",{class:"token operator"},"=="),a(),l("span",{class:"token number"},"200"),l("span",{class:"token punctuation"},")"),a(),l("span",{class:"token punctuation"},"{"),a("\n                console"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function"},"log"),l("span",{class:"token punctuation"},"("),a("xhr"),l("span",{class:"token punctuation"},"."),a("responseText"),l("span",{class:"token punctuation"},")"),l("span",{class:"token punctuation"},";"),a("\n            "),l("span",{class:"token punctuation"},"}"),a("\n        "),l("span",{class:"token punctuation"},"}"),a("\n      xhr"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function"},"send"),l("span",{class:"token punctuation"},"("),l("span",{class:"token punctuation"},")"),l("span",{class:"token punctuation"},";"),a("\n    ")])]),l("span",{class:"token tag"},[l("span",{class:"token tag"},[l("span",{class:"token punctuation"},"</"),a("script")]),l("span",{class:"token punctuation"},">")]),a("\n  "),l("span",{class:"token tag"},[l("span",{class:"token tag"},[l("span",{class:"token punctuation"},"</"),a("body")]),l("span",{class:"token punctuation"},">")]),a("\n"),l("span",{class:"token tag"},[l("span",{class:"token tag"},[l("span",{class:"token punctuation"},"</"),a("html")]),l("span",{class:"token punctuation"},">")]),a("\n")])])],-1),l("p",null,[l("strong",null,"æœåŠ¡ç«¯")],-1),l("ul",null,[l("li",null,"é™æ€èµ„æº")],-1),l("div",{class:"language-shell"},[l("pre",null,[l("code",null,[l("span",{class:"token function"},"mkdir"),a(" -p /data/json\n"),l("span",{class:"token builtin class-name"},"cd"),a(" /data/json\n"),l("span",{class:"token function"},"vi"),a(" user.json\n"),l("span",{class:"token punctuation"},"{"),l("span",{class:"token string"},'"name"'),l("span",{class:"token builtin class-name"},":"),l("span",{class:"token string"},'"å‰ç«¯å£¹ç”²å£¹"'),l("span",{class:"token punctuation"},"}"),a("\n")])])],-1),l("ul",null,[l("li",null,"nginx é…ç½®")],-1),l("div",{class:"language-nginx"},[l("pre",null,[l("code",null,[l("span",{class:"token directive"},[l("span",{class:"token keyword"},"location"),a(" ~ .*\\.json$")]),a(),l("span",{class:"token punctuation"},"{"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"add_header"),a(" Access-Control-Allow-Origin http://127.0.0.1:8080")]),l("span",{class:"token punctuation"},";"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"add_header"),a(" Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS")]),l("span",{class:"token punctuation"},";"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"root"),a(" /data/json")]),l("span",{class:"token punctuation"},";"),a("\n"),l("span",{class:"token punctuation"},"}"),a("\n")])])],-1),l("h3",{id:"_3-4ã€ä»£ç†"},[l("a",{class:"header-anchor",href:"#_3-4ã€ä»£ç†","aria-hidden":"true"},"#"),a(" 3.4ã€ä»£ç†")],-1),l("p",null,[a("é€šè¿‡åœ¨ "),l("code",null,"server"),a(" æˆ– "),l("code",null,"location"),a(" ä¸­è®¾ç½® "),l("code",null,"proxy_pass"),a(" æ¥å®ç°ä»£ç†")],-1),l("h4",{id:"_3-4-1ã€æ­£å‘ä»£ç†"},[l("a",{class:"header-anchor",href:"#_3-4-1ã€æ­£å‘ä»£ç†","aria-hidden":"true"},"#"),a(" 3.4.1ã€æ­£å‘ä»£ç†")],-1),l("p",null,"æ­£å‘ä»£ç†çš„å¯¹è±¡æ˜¯å®¢æˆ·ç«¯,æœåŠ¡å™¨ç«¯çœ‹ä¸åˆ°çœŸæ­£çš„å®¢æˆ·ç«¯ï¼Œä¾‹å¦‚ç¿»å¢™ä½¿ç”¨çš„VPN",-1),l("h4",{id:"_3-4-2ã€åå‘ä»£ç†"},[l("a",{class:"header-anchor",href:"#_3-4-2ã€åå‘ä»£ç†","aria-hidden":"true"},"#"),a(" 3.4.2ã€åå‘ä»£ç†")],-1),l("p",null,"åå‘ä»£ç†çš„å¯¹è±¡çš„æœåŠ¡ç«¯,å®¢æˆ·ç«¯çœ‹ä¸åˆ°çœŸæ­£çš„æœåŠ¡ç«¯ï¼Œä¾‹å¦‚ nginx ä»£ç†çš„åº”ç”¨æœåŠ¡å™¨",-1),l("div",{class:"language-nginx"},[l("pre",null,[l("code",null,[l("span",{class:"token directive"},[l("span",{class:"token keyword"},"location"),a(" ~ ^/api")]),a(),l("span",{class:"token punctuation"},"{"),a("\n    "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"proxy_pass"),a(" http://localhost:3000")]),l("span",{class:"token punctuation"},";"),a("\n    "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"proxy_redirect"),a(" default")]),l("span",{class:"token punctuation"},";"),a(),l("span",{class:"token comment"},"#é‡å®šå‘"),a("\n\n    "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"proxy_set_header"),a(" Host "),l("span",{class:"token variable"},"$http_host")]),l("span",{class:"token punctuation"},";"),a("        "),l("span",{class:"token comment"},"#å‘åä¼ é€’å¤´ä¿¡æ¯"),a("\n    "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"proxy_set_header"),a(" X-Real-IP "),l("span",{class:"token variable"},"$remote_addr")]),l("span",{class:"token punctuation"},";"),a(),l("span",{class:"token comment"},"#æŠŠçœŸå®IPä¼ ç»™åº”ç”¨æœåŠ¡å™¨"),a("\n\n    "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"proxy_connect_timeout"),a(),l("span",{class:"token number"},"30")]),l("span",{class:"token punctuation"},";"),a("  "),l("span",{class:"token comment"},"#é»˜è®¤è¶…æ—¶æ—¶é—´"),a("\n    "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"proxy_send_timeout"),a(),l("span",{class:"token number"},"60")]),l("span",{class:"token punctuation"},";"),a("    "),l("span",{class:"token comment"},"# å‘é€è¶…æ—¶"),a("\n    "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"proxy_read_timeout"),a(),l("span",{class:"token number"},"60")]),l("span",{class:"token punctuation"},";"),a("    "),l("span",{class:"token comment"},"# è¯»å–è¶…æ—¶"),a("\n"),l("span",{class:"token punctuation"},"}"),a("\n")])])],-1),l("p",null,[l("strong",null,[l("code",null,"proxy_pass")])],-1),l("ul",null,[l("li",null,[l("code",null,"proxy_pass"),a(" åçš„ "),l("code",null,"url"),a(" æœ€ååŠ ä¸Š "),l("code",null,"/"),a(" å°±æ˜¯ç»å¯¹æ ¹è·¯å¾„, "),l("code",null,"location"),a(" ä¸­åŒ¹é…çš„è·¯å¾„éƒ¨åˆ†ä¸èµ°ä»£ç†,ä¹Ÿå°±æ˜¯è¯´ä¼šè¢«æ›¿æ¢æ‰")])],-1),l("div",{class:"language-nginx"},[l("pre",null,[l("code",null,[l("span",{class:"token directive"},[l("span",{class:"token keyword"},"location"),a(" /a/")]),a(),l("span",{class:"token punctuation"},"{"),a("\n    "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"proxy_pass"),a(" http://127.0.0.1/b/")]),l("span",{class:"token punctuation"},";"),a("\n"),l("span",{class:"token punctuation"},"}"),a("\n"),l("span",{class:"token comment"},"# è¯·æ±‚ http://example.com/a/test.html, ä¼šè¢«ä»£ç†åˆ° http://127.0.0.1/b/test.html"),a("\n")])])],-1),l("ul",null,[l("li",null,[l("code",null,"proxy_pass"),a(" åçš„ "),l("code",null,"url"),a(" æœ€åæ²¡æœ‰ "),l("code",null,"/"),a(" å°±æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œ"),l("code",null,"location"),a(" ä¸­åŒ¹é…çš„è·¯å¾„éƒ¨åˆ†ä¼šèµ°ä»£ç†,ä¹Ÿå°±æ˜¯è¯´ä¼šä¿ç•™")])],-1),l("div",{class:"language-nginx"},[l("pre",null,[l("code",null,[l("span",{class:"token directive"},[l("span",{class:"token keyword"},"location"),a(" /a/")]),a(),l("span",{class:"token punctuation"},"{"),a("\n    "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"proxy_pass"),a(" http://127.0.0.1")]),l("span",{class:"token punctuation"},";"),a("\n"),l("span",{class:"token punctuation"},"}"),a("\n"),l("span",{class:"token comment"},"# è¯·æ±‚ http://example.com/a/test.html, ä¼šè¢«ä»£ç†åˆ° http://127.0.0.1/a/test.html"),a("\n")])])],-1),l("p",null,[a("(PS: ä¸ºäº†æ–¹ä¾¿è®°å¿†å’Œè§„èŒƒé…ç½®ï¼Œå»ºè®®æ‰€æœ‰çš„ "),l("code",null,"proxy_pass"),a(" åçš„"),l("code",null,"url"),a("éƒ½ä»¥"),l("code",null,"/"),a("ç»“å°¾ )")],-1),l("ul",null,[l("li",null,[a("åœ¨"),l("code",null,"proxy_pass"),a("å‰é¢ç”¨äº†"),l("code",null,"rewrite"),a("ï¼Œå¦‚ä¸‹ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œ"),l("code",null,"proxy_pass"),a("æ˜¯æ— æ•ˆçš„")])],-1),l("div",{class:"language-nginx"},[l("pre",null,[l("code",null,[l("span",{class:"token directive"},[l("span",{class:"token keyword"},"location"),a(" /getName/")]),a(),l("span",{class:"token punctuation"},"{"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"rewrite"),a("    /getName/([^/]+) /users?name="),l("span",{class:"token variable"},"$1"),a(" break")]),l("span",{class:"token punctuation"},";"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"proxy_pass"),a(" http://127.0.0.1")]),l("span",{class:"token punctuation"},";"),a("\n"),l("span",{class:"token punctuation"},"}"),a("\n")])])],-1),l("h3",{id:"_3-5ã€è´Ÿè½½å‡è¡¡"},[l("a",{class:"header-anchor",href:"#_3-5ã€è´Ÿè½½å‡è¡¡","aria-hidden":"true"},"#"),a(" 3.5ã€è´Ÿè½½å‡è¡¡")],-1),l("p",null,"å½“ç½‘ç«™å‡ºè¡Œé«˜å¹¶å‘ï¼Œè®¿é—®é‡å¤§æ—¶ï¼Œä¸€å°æœåŠ¡å™¨çš„å¤„ç†èƒ½åŠ›ã€å­˜å‚¨ç©ºé—´ä¸è¶³æ—¶ï¼Œåº”è¯¥å¢åŠ ä¸€å°æœåŠ¡å™¨å»åˆ†æ‹…ç½‘ç«™çš„è®¿é—®åŠå­˜å‚¨å‹åŠ›ã€‚",-1),l("p",null,"é€šè¿‡è´Ÿè½½å‡è¡¡è°ƒåº¦æœåŠ¡å™¨ï¼Œå°†æ‰€æœ‰çš„è®¿é—®è¯·æ±‚åˆ†å‘åˆ°åº”ç”¨æœåŠ¡å™¨é›†ç¾¤ä¸­çš„ä»»ä½•ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œå½“æœ‰æ›´å¤šçš„è®¿é—®ï¼Œå°±åœ¨é›†ç¾¤ä¸­åŠ å…¥æ›´å¤šçš„åº”ç”¨æœåŠ¡å™¨",-1),l("h4",{id:"_3-5-1ã€upstream"},[l("a",{class:"header-anchor",href:"#_3-5-1ã€upstream","aria-hidden":"true"},"#"),a(" 3.5.1ã€upstream")],-1),l("p",null,[a("é€šè¿‡ "),l("code",null,"upstream"),a(" å®šä¹‰ä¸€ç»„æœåŠ¡æ± ï¼Œnginx æŠŠè¯·æ±‚è½¬å‘åˆ°æœåŠ¡æ± ")],-1),l("div",{class:"language-nginx"},[l("pre",null,[l("code",null,[l("span",{class:"token directive"},[l("span",{class:"token keyword"},"upstream"),a(" webServer")]),a(),l("span",{class:"token punctuation"},"{"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"server"),a(" 127.0.0.1:3000")]),l("span",{class:"token punctuation"},";"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"server"),a(" 127.0.0.1:4000")]),l("span",{class:"token punctuation"},";"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"server"),a(" 127.0.0.1:5000")]),l("span",{class:"token punctuation"},";"),a("\n"),l("span",{class:"token punctuation"},"}"),a("\n")])])],-1),l("h4",{id:"_3-5-2ã€åç«¯æœåŠ¡å™¨è°ƒè¯•çŠ¶æ€"},[l("a",{class:"header-anchor",href:"#_3-5-2ã€åç«¯æœåŠ¡å™¨è°ƒè¯•çŠ¶æ€","aria-hidden":"true"},"#"),a(" 3.5.2ã€åç«¯æœåŠ¡å™¨è°ƒè¯•çŠ¶æ€")],-1),l("table",null,[l("thead",null,[l("tr",null,[l("th",null,"çŠ¶æ€"),l("th",null,"æè¿°")])]),l("tbody",null,[l("tr",null,[l("td",null,[l("strong",null,[l("code",null,"down")])]),l("td",null,"å½“å‰æœåŠ¡å™¨ä¸å‚ä¸è´Ÿè½½å‡è¡¡")]),l("tr",null,[l("td",null,[l("strong",null,[l("code",null,"backup")])]),l("td",null,"å½“å…¶å®ƒèŠ‚ç‚¹éƒ½æ— æ³•ä½¿ç”¨æ—¶çš„å¤‡ä»½æœåŠ¡å™¨")]),l("tr",null,[l("td",null,[l("strong",null,[l("code",null,"max_fails")])]),l("td",null,"å…è®¸è¯·æ±‚å¤±è´¥çš„æ¬¡æ•°, åˆ°è¾¾æœ€å¤§æ¬¡æ•°å°±ä¼šä¼‘çœ ")]),l("tr",null,[l("td",null,[l("strong",null,[l("code",null,"fail_timeout")])]),l("td",null,"ç»è¿‡ max_fails å¤±è´¥åï¼ŒæœåŠ¡å™¨ä¼‘çœ æ—¶é—´,é»˜è®¤10ç§’")]),l("tr",null,[l("td",null,[l("strong",null,[l("code",null,"max_conns")])]),l("td",null,"å½“å‰æœåŠ¡å™¨å¯æ¥æ”¶çš„æœ€å¤§è¿æ¥æ•°")])])],-1),l("div",{class:"language-nginx"},[l("pre",null,[l("code",null,[l("span",{class:"token directive"},[l("span",{class:"token keyword"},"upstream"),a(" webServer")]),a(),l("span",{class:"token punctuation"},"{"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"server"),a(" 127.0.0.1:3000 down")]),l("span",{class:"token punctuation"},";"),a(),l("span",{class:"token comment"},"#ä¸å‚ä¸è´Ÿè½½å‡è¡¡"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"server"),a(" 127.0.0.1:4000 backup")]),l("span",{class:"token punctuation"},";"),a(),l("span",{class:"token comment"},"#å……å½“å¤‡ä»½æœåŠ¡å™¨"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"server"),a(" 127.0.0.1:5000")]),a(),l("span",{class:"token punctuation"},";"),a("\n"),l("span",{class:"token punctuation"},"}"),a("\n")])])],-1),l("h4",{id:"_3-5-2ã€åˆ†é…æ–¹å¼"},[l("a",{class:"header-anchor",href:"#_3-5-2ã€åˆ†é…æ–¹å¼","aria-hidden":"true"},"#"),a(" 3.5.2ã€åˆ†é…æ–¹å¼")],-1),l("table",null,[l("thead",null,[l("tr",null,[l("th",null,"ç±»å‹"),l("th",null,"æè¿°")])]),l("tbody",null,[l("tr",null,[l("td",null,"è½®è¯¢(é»˜è®¤)"),l("td",null,[l("strong",null,"å¹³å‡ä¸»ä¹‰"),a(", æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå½“æŸä¸ªæœåŠ¡å™¨downæ‰ï¼Œä¼šè¢«è‡ªåŠ¨å‰”é™¤")])]),l("tr",null,[l("td",null,[l("strong",null,[l("code",null,"weight")])]),l("td",null,[l("strong",null,"åŠ æƒè½®è¯¢"),a("ï¼Œé€šè¿‡"),l("code",null,"weight"),a("æŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œ"),l("code",null,"weight"),a("å’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”")])]),l("tr",null,[l("td",null,[l("strong",null,[l("code",null,"ip_hash")])]),l("td",null,[a("æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®"),l("code",null,"ip"),a("çš„"),l("code",null,"hash"),a("ç»“æœåˆ†é…, æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³"),l("code",null,"session"),a(" çš„é—®é¢˜")])]),l("tr",null,[l("td",null,[l("strong",null,[l("code",null,"least_conn")])]),l("td",null,"å“ªä¸ªæœºå™¨ä¸Šè¿æ¥æ•°å°‘å°±åˆ†å‘ç»™è°")]),l("tr",null,[l("td",null,[l("strong",null,[l("code",null,"url_hash")])]),l("td",null,[a("æŒ‰è®¿é—®çš„"),l("code",null,"URL"),a("åœ°å€æ¥åˆ†é… è¯·æ±‚ï¼Œæ¯ä¸ª"),l("code",null,"URL"),a("éƒ½å®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ä¸Š(ç¼“å­˜)ã€‚(ps: "),l("em",null,"ç¬¬ä¸‰æ–¹"),a("ï¼‰")])]),l("tr",null,[l("td",null,[l("strong",null,[l("code",null,"fair")])]),l("td",null,[a("æŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚ï¼ˆps: "),l("em",null,"ç¬¬ä¸‰æ–¹"),a("ï¼‰")])])])],-1),l("div",{class:"language-nginx"},[l("pre",null,[l("code",null,[l("span",{class:"token comment"},"# weight"),a("\n"),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"upstream"),a(" webServer")]),a(),l("span",{class:"token punctuation"},"{"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"server"),a(" 127.0.0.1:3000 weight=1")]),l("span",{class:"token punctuation"},";"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"server"),a(" 127.0.0.1:4000 weight=2")]),l("span",{class:"token punctuation"},";"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"server"),a(" 127.0.0.1:5000 weight=4")]),l("span",{class:"token punctuation"},";"),a("\n"),l("span",{class:"token punctuation"},"}"),a("\n")])])],-1),l("div",{class:"language-nginx"},[l("pre",null,[l("code",null,[l("span",{class:"token comment"},"# ip_hash"),a("\n"),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"upstream"),a(" webServer")]),a(),l("span",{class:"token punctuation"},"{"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"ip_hash"),a(),l("span",{class:"token comment"},"# [type], type = ip_hash | least_conn | url_hash | fair"),a("\n  server 127.0.0.1:3000")]),l("span",{class:"token punctuation"},";"),a("\n"),l("span",{class:"token punctuation"},"}"),a("\n")])])],-1),l("h2",{id:"_4ã€location"},[l("a",{class:"header-anchor",href:"#_4ã€location","aria-hidden":"true"},"#"),a(" 4ã€location")],-1),l("p",null,[l("code",null,"location"),a(" ä¼šç”¨æ¥åŒ¹é… "),l("code",null,"URI"),a("ï¼Œä½†ä¼šå¿½ç•¥å…¶ä¸­çš„å‚æ•°")],-1),l("h3",{id:"_4-1ã€æ­£åˆ™è¡¨è¾¾å¼"},[l("a",{class:"header-anchor",href:"#_4-1ã€æ­£åˆ™è¡¨è¾¾å¼","aria-hidden":"true"},"#"),a(" 4.1ã€æ­£åˆ™è¡¨è¾¾å¼")],-1),l("table",null,[l("thead",null,[l("tr",null,[l("th",null,"ç±»å‹"),l("th",null,"æè¿°")])]),l("tbody",null,[l("tr",null,[l("td",null,[l("code",null,".")]),l("td",null,"åŒ¹é…é™¤æ¢è¡Œç¬¦ä¹‹å¤–çš„ä»»æ„å­—ç¬¦")]),l("tr",null,[l("td",null,[l("code",null,"?")]),l("td",null,"é‡å¤0æ¬¡æˆ–1æ¬¡")]),l("tr",null,[l("td",null,[l("code",null,"+")]),l("td",null,"é‡å¤1æ¬¡æˆ–æ›´å¤šæ¬¡")]),l("tr",null,[l("td",null,[l("code",null,"*")]),l("td",null,"é‡å¤0æ¬¡æˆ–å¤šæ¬¡")]),l("tr",null,[l("td",null,[l("code",null,"^")]),l("td",null,"åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹")]),l("tr",null,[l("td",null,[l("code",null,"$")]),l("td",null,"åŒ¹é…å­—ç¬¦ä¸²çš„ç»“æŸ")]),l("tr",null,[l("td",null,[l("code",null,"{n}")]),l("td",null,"é‡å¤næ¬¡")]),l("tr",null,[l("td",null,[l("code",null,"{n,}")]),l("td",null,"é‡å¤næ¬¡æˆ–æ›´å¤šæ¬¡")]),l("tr",null,[l("td",null,[l("code",null,"[abc]")]),l("td",null,"åŒ¹é…å•ä¸ªå­—ç¬¦aæˆ–è€…bæˆ–è€…c")]),l("tr",null,[l("td",null,[l("code",null,"a-z")]),l("td",null,"åŒ¹é…a-zå°å†™å­—æ¯çš„ä»»æ„ä¸€ä¸ª")]),l("tr",null,[l("td",null,[l("code",null,"\\")]),l("td",null,"è½¬ä¹‰å­—ç¬¦")]),l("tr",null,[l("td",null,[l("code",null,"()")]),l("td",null,"åˆ†ç»„ï¼Œç”¨äºåŒ¹é…æ‹¬å·ä¹‹é—´çš„å†…å®¹ï¼Œå¯ä»¥é€šè¿‡$1ã€$2å¼•ç”¨")]),l("tr",null,[l("td",null,[l("code",null,"\\w")]),l("td",null,[a("æŒ‡åŒ…å«å¤§ å°å†™å­—æ¯æ•°å­—å’Œä¸‹åˆ’çº¿ ç›¸å½“äº("),l("code",null,"[0-9a-zA-Z]"),a(")")])])])],-1),l("h3",{id:"_4-2ã€è¯­æ³•è§„åˆ™"},[l("a",{class:"header-anchor",href:"#_4-2ã€è¯­æ³•è§„åˆ™","aria-hidden":"true"},"#"),a(" 4.2ã€è¯­æ³•è§„åˆ™")],-1),l("ul",null,[l("li",null,[a("å‰ç¼€åŒ¹é… "),l("ul",null,[l("li",null,"å¸¸è§„"),l("li",null,[l("code",null,"="),a(", ç²¾ç¡®åŒ¹é…")]),l("li",null,[l("code",null,"^~"),a(", åŒ¹é…ä¸Šååˆ™ä¸å†ç»§ç»­è¿›è¡Œæ­£åˆ™çš„åŒ¹é…")])])]),l("li",null,[a("æ­£åˆ™è¡¨è¾¾å¼ "),l("ul",null,[l("li",null,[l("code",null,"~"),a(", å¤§å°å†™æ•æ„Ÿçš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…")]),l("li",null,[l("code",null,"~*"),a(", å¿½ç•¥å¤§å°å†™æ•æ„Ÿçš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…")])])]),l("li",null,[a("å†…éƒ¨è°ƒè½¬ "),l("ul",null,[l("li",null,[a("ç”¨äºå†…éƒ¨è·³è½¬çš„å‘½å "),l("code",null,"location @xxx")])])])],-1),l("div",{class:"language-nginx"},[l("pre",null,[l("code",null,[l("span",{class:"token directive"},[l("span",{class:"token keyword"},"location"),a(" [=|~|~*|^~] uri")]),a(),l("span",{class:"token punctuation"},"{"),a("..."),l("span",{class:"token punctuation"},"}"),a("\n\n"),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"location"),a(" @name")]),l("span",{class:"token punctuation"},"{"),a("..."),l("span",{class:"token punctuation"},"}"),a("\n")])])],-1),l("h3",{id:"_4-3ã€åŒ¹é…è§„åˆ™"},[l("a",{class:"header-anchor",href:"#_4-3ã€åŒ¹é…è§„åˆ™","aria-hidden":"true"},"#"),a(" 4.3ã€åŒ¹é…è§„åˆ™")],-1),l("p",null,[l("img",{src:"/portal-blog/images/linux/nginx-location.png",alt:""})],-1),l("ul",null,[l("li",null,"ç­‰å·ç±»å‹ï¼ˆ=ï¼‰çš„ä¼˜å…ˆçº§æœ€é«˜"),l("li",null,"^~ç±»å‹è¡¨è¾¾å¼çš„ä¼˜å…ˆçº§æ¬¡ä¹‹"),l("li",null,"åä¹‹ï¼Œåˆ™åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ç±»å‹ï¼ˆ~ ~*ï¼‰ï¼Œå¦‚æœæœ‰å¤šä¸ªlocationçš„æ­£åˆ™èƒ½åŒ¹é…çš„è¯ï¼Œåˆ™ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœ€é•¿çš„é‚£ä¸ª"),l("li",null,"æœ€åï¼Œå¸¸è§„å­—ç¬¦ä¸²åŒ¹é…ç±»å‹æŒ‰å‰ç¼€åŒ¹é…")],-1),l("div",{class:"language-"},[l("pre",null,[l("code",null,"location ~ /T1/$ {\n  return 200 'åŒ¹é…åˆ°ç¬¬ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼';\n}\nlocation ~* /T1/(\\w+)$ {\n  return 200 'åŒ¹é…åˆ°æœ€é•¿çš„æ­£åˆ™è¡¨è¾¾å¼';\n}\nlocation ^~ /T1/ {\n  return 200 'åœæ­¢åç»­çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…';\n}\nlocation  /T1/T2 {\n  return 200 'æœ€é•¿çš„å‰ç¼€è¡¨è¾¾å¼åŒ¹é…';\n}\nlocation  /T1 {\n  return 200 'å‰ç¼€è¡¨è¾¾å¼åŒ¹é…';\n}\nlocation = /T1 {\n  return 200 'ç²¾ç¡®åŒ¹é…';\n}\n")])],-1),l("div",{class:"language-"},[l("pre",null,[l("code",null,"/T1     //ç²¾ç¡®åŒ¹é…\n/T1/    //åœæ­¢åç»­çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…\n/T1/T2  //åŒ¹é…åˆ°æœ€é•¿çš„æ­£åˆ™è¡¨è¾¾å¼\n/T1/T2/ //æœ€é•¿çš„å‰ç¼€è¡¨è¾¾å¼åŒ¹é…\n/t1/T2  //åŒ¹é…åˆ°æœ€é•¿çš„æ­£åˆ™è¡¨è¾¾å¼\n")])],-1),l("h2",{id:"_5ã€rewrite"},[l("a",{class:"header-anchor",href:"#_5ã€rewrite","aria-hidden":"true"},"#"),a(" 5ã€rewrite")],-1),l("p",null,[a("é€šè¿‡ "),l("code",null,"rewrite"),a(" å®ç° url é‡å†™åŠé‡å®šå‘")],-1),l("p",null,[l("strong",null,"è¯­æ³•")],-1),l("div",{class:"language-"},[l("pre",null,[l("code",null,"rewrite regex replacement [flag]\n")])],-1),l("p",null,[l("strong",null,"flag")],-1),l("p",null,"flag: æ ‡è¯†è§„åˆ™å¯¹åº”çš„ç±»å‹",-1),l("table",null,[l("thead",null,[l("tr",null,[l("th",null,"ç±»å‹"),l("th",null,"æè¿°")])]),l("tbody",null,[l("tr",null,[l("td",null,[l("code",null,"last")]),l("td",null,[a("å…ˆåŒ¹é…è‡ªå·±çš„location,ç„¶åé€šè¿‡"),l("code",null,"rewrite"),a("è§„åˆ™æ–°å»ºä¸€ä¸ªè¯·æ±‚å†æ¬¡è¯·æ±‚æœåŠ¡ç«¯")])]),l("tr",null,[l("td",null,[l("code",null,"break")]),l("td",null,"å…ˆåŒ¹é…è‡ªå·±çš„location,ç„¶åç”Ÿå‘½å‘¨æœŸä¼šåœ¨å½“å‰çš„locationç»“æŸ,ä¸å†è¿›è¡Œåç»­çš„åŒ¹é…")]),l("tr",null,[l("td",null,[l("code",null,"redirect")]),l("td",null,"è¿”å›302æ˜¨æ—¶é‡å®šå‘,ä»¥åè¿˜ä¼šè¯·æ±‚è¿™ä¸ªæœåŠ¡å™¨")]),l("tr",null,[l("td",null,[l("code",null,"permanent")]),l("td",null,"è¿”å›301æ°¸ä¹…é‡å®šå‘,ä»¥åä¼šç›´æ¥è¯·æ±‚æ°¸ä¹…é‡å®šå‘åçš„åŸŸå")])])],-1),l("div",{class:"language-nginx"},[l("pre",null,[l("code",null,[l("span",{class:"token directive"},[l("span",{class:"token keyword"},"location"),a(" ~ ^/break")]),a(),l("span",{class:"token punctuation"},"{"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"rewrite"),a(" ^/break /test break")]),l("span",{class:"token punctuation"},";"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"root"),a(" /data/html")]),l("span",{class:"token punctuation"},";"),a("\n"),l("span",{class:"token punctuation"},"}"),a("\n\n"),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"location"),a(" ~ ^/last")]),a(),l("span",{class:"token punctuation"},"{"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"rewrite"),a(" ^/last /test last")]),l("span",{class:"token punctuation"},";"),a("\n"),l("span",{class:"token punctuation"},"}"),a("\n\n"),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"location"),a(" /test")]),a(),l("span",{class:"token punctuation"},"{"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"default_type"),a(" application/json")]),l("span",{class:"token punctuation"},";"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"return"),a(),l("span",{class:"token number"},"200"),a(),l("span",{class:"token string"},'\'{"code":0,"msg":"success"}\'')]),l("span",{class:"token punctuation"},";"),a("\n"),l("span",{class:"token punctuation"},"}"),a("\n\n"),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"location"),a(" ~ ^/redirect")]),a(),l("span",{class:"token punctuation"},"{"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"rewrite"),a(" ^/redirect http://www.baidu.com redirect")]),l("span",{class:"token punctuation"},";"),a("\n"),l("span",{class:"token punctuation"},"}"),a("\n"),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"location"),a(" ~ ^/permanent")]),a(),l("span",{class:"token punctuation"},"{"),a("\n  "),l("span",{class:"token directive"},[l("span",{class:"token keyword"},"rewrite"),a(" ^/permanent http://www.baidu.com permanent")]),l("span",{class:"token punctuation"},";"),a("\n"),l("span",{class:"token punctuation"},"}"),a("\n")])])],-1),l("div",{class:"language-shell"},[l("pre",null,[l("code",null,[l("span",{class:"token comment"},"# curl http://localhost/last"),a("\n"),l("span",{class:"token punctuation"},"{"),l("span",{class:"token string"},'"code"'),a(":0,"),l("span",{class:"token string"},'"msg"'),l("span",{class:"token builtin class-name"},":"),l("span",{class:"token string"},'"success"'),l("span",{class:"token punctuation"},"}"),a("\n\n"),l("span",{class:"token comment"},"# curl http://localhost/break"),a("\n"),l("span",{class:"token builtin class-name"},"test"),a(),l("span",{class:"token comment"},"# å¹¶æ²¡æœ‰ç»§ç»­åŒ¹é…åˆ° `/test`, è€Œæ˜¯ç›´æ¥ç»ˆæ­¢ï¼Œå» /data/html/ ç›®å½•ä¸‹å»åŒ¹é… test ç›®å½•"),a("\n\n"),l("span",{class:"token comment"},"# curl -vL http://localhost/redirect"),a("\n\n"),l("span",{class:"token comment"},"# curl -vL http://localhost/permanent"),a("\n")])])],-1)];e.render=function(l,a,t,e,c,u){return n(),s("div",null,o)};export{t as __pageData,e as default};
